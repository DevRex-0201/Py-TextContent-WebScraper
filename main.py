import os
import requests
from bs4 import BeautifulSoup
from urllib.parse import urljoin, urlparse

site_url = "https://member.lieberleichter.de/"
login_url = "https://member.lieberleichter.de/wp-admin/admin-ajax.php"
page_url = "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1225"
loginname = "M.Ferfers@qwan.de"
password = "f3Wr3a4Uk"

# Session erstellen und auf der Website anmelden
session = requests.Session()

# Login-Anforderung senden (assuming it's a POST request)
login_data = {
    "action": "mesuajaxlogin",  # Replace with the actual action value for login
    "username": loginname,
    "password": password,
    "redirect_to": ""
}

# Set headers if needed, e.g., for AJAX requests
headers = {
    "Content-Type": "application/x-www-form-urlencoded",
}

try:
    login_response = session.post(login_url, data=login_data, headers=headers)
    login_response.raise_for_status()
    print("Login successful")
except requests.exceptions.HTTPError as err:
    print(f"Login failed with status code: {login_response.status_code}")
    print(f"Error details: {err}")
    exit()

links = ["https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_49483", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50557", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50959", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50962", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-4-eiweisse/", "https://member.lieberleichter.de/unit/ll-m5-u3-protein-shakes/", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50966", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50968", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50970", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_7319", "https://member.lieberleichter.de/module/moderne-ernaehrungsmedizin/?unit_id=1820", "https://member.lieberleichter.de/module/abnehmcoaching/?unit_id=50962", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_49486", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_34442", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1030", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_16794", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_472", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_16794", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_3740", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1232", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1225", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1219", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_527", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1239", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_1970", "https://member.lieberleichter.de/p/lieberleichter-umsetzungskurs/#mesu_module_3763", "https://member.lieberleichter.de/module/moderne-ernaehrungsmedizin/?unit_id=498", "https://member.lieberleichter.de/module/moderne-ernaehrungsmedizin/?unit_id=498", "https://member.lieberleichter.de/unit/ll_anti-entzuendliche-ernaehrung/", "https://member.lieberleichter.de/unit/ll-14-metabolisches-syndrom/", "https://member.lieberleichter.de/unit/ll-m6-u5-insulinresistenz/", "https://member.lieberleichter.de/unit/ll-bonus-fettleber/", "https://member.lieberleichter.de/unit/ll-m6-u4-diabetes-epidemie-stoppen/", "https://member.lieberleichter.de/unit/bluthochdruck/", "https://member.lieberleichter.de/unit/ll-m8-u3-cholesterin-natuerlich-senken/", "https://member.lieberleichter.de/unit/unit-11-8-abnehmbremsen/", "https://member.lieberleichter.de/unit/modul-11-u9-darm/", "https://member.lieberleichter.de/unit/ll-m14-autoimmunerkrankungen/", "https://member.lieberleichter.de/unit/ll-m14-unit-14-18-gelenke/", "https://member.lieberleichter.de/unit/modul-9-u3-mentale-gesundheit/", "https://member.lieberleichter.de/unit/ll-bonus-u2-entgiftung/", "https://member.lieberleichter.de/unit/ll-m9-u5-laboranalysen/", "https://member.lieberleichter.de/unit/ll-m8-u5-saeure-basen-haushalt/", "https://member.lieberleichter.de/unit/blue-zones-das-geheimnis-der-100-jaehrigen/", "https://member.lieberleichter.de/module/abnehmcoaching/", "https://member.lieberleichter.de/module/abnehmcoaching/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-1-grundlagen/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-2-ernaehrungsprotokoll/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-3-kurzzeitfasten/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-4-eiweisse/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-5-kohlenhydrate/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-6-zucker/", "https://member.lieberleichter.de/unit/abnehmcoaching-lektion-7-fette/", "https://member.lieberleichter.de/module/ll-umsetzung-m1-vorbereitung/", "https://member.lieberleichter.de/module/ll-umsetzung-m1-vorbereitung/", "https://member.lieberleichter.de/unit/ll-m0-u1-begruessung/", "https://member.lieberleichter.de/unit/ll-m0-u2-erklaerung-mitgliederbereich/", "https://member.lieberleichter.de/unit/ll-umsetzung-m1-u3-fragebogen-motivation/", "https://member.lieberleichter.de/unit/ll-m0-u4-ernaehrungs-apps/", "https://member.lieberleichter.de/unit/ll-m0-u5-waagen-fuer-koerper-und-kueche/", "https://member.lieberleichter.de/unit/ll-m0-u6-erfolgs-und-ernaehrungs-journal/", "https://member.lieberleichter.de/unit/webinaraufzeichnungen-kick-off/", "https://member.lieberleichter.de/module/ll-umsetzung-m2-naehrstoff-bedarf/", "https://member.lieberleichter.de/module/ll-umsetzung-m2-naehrstoff-bedarf/", "https://member.lieberleichter.de/unit/ll-m2-u1-begruessung/", "https://member.lieberleichter.de/unit/ll-m2-u2-die-kalorien-bilanz/", "https://member.lieberleichter.de/unit/ll-m2-u3-kalorien-bedarf-berechnen/", "https://member.lieberleichter.de/unit/ll-m2-u4-das-ernaehrungs-protokoll/", "https://member.lieberleichter.de/unit/ll-m2-u5-emotionales-essen/", "https://member.lieberleichter.de/unit/ll-m2-u7-blutzucker-sensor-messung-personalisierte-ernaehrung/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnung-naehrstoff-bedarf/", "https://member.lieberleichter.de/module/ll-umsetzung-m3-kurzzeitfasten/", "https://member.lieberleichter.de/module/ll-umsetzung-m3-kurzzeitfasten/", "https://member.lieberleichter.de/unit/ll-m3-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m3-u2-die-16-8-methode/", "https://member.lieberleichter.de/unit/ll-m3-u3-externe-berichte/", "https://member.lieberleichter.de/unit/ll-m3-u4-leberfasten/", "https://member.lieberleichter.de/unit/ll-heilfasten-unit-3-4-m3/", "https://member.lieberleichter.de/unit/ll-schein-fasten-m3-unit-3-4/", "https://member.lieberleichter.de/module/ll-umsetzung-m4-protein-faktor/", "https://member.lieberleichter.de/module/ll-umsetzung-m4-protein-faktor/", "https://member.lieberleichter.de/unit/ll-m5-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m5-u2-eiweiss/", "https://member.lieberleichter.de/unit/ll-m5-u3-protein-shakes/", "https://member.lieberleichter.de/unit/ll-m5-u4-eiweiss-fuer-vegetarier-veganer/", "https://member.lieberleichter.de/unit/ll-m5-u5-tipps-rezepte-literatur/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnung-protein-bedarf/", "https://member.lieberleichter.de/module/ll-umsetzung-m5-low-carb/", "https://member.lieberleichter.de/module/ll-umsetzung-m5-low-carb/", "https://member.lieberleichter.de/unit/ll-m6-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m6-u2-vortrag-low-carb/", "https://member.lieberleichter.de/unit/ll-m6-u3-low-carb-fruehstueck/", "https://member.lieberleichter.de/unit/ll-m6-u6-weitere-infos-tipps/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-low-carb/", "https://member.lieberleichter.de/module/ll-umsetzung-m6-zucker/", "https://member.lieberleichter.de/module/ll-umsetzung-m6-zucker/", "https://member.lieberleichter.de/unit/ll-m7-u1-einfuehrung-clean-eating/", "https://member.lieberleichter.de/unit/ll-m7-u2-zucker-vermeiden/", "https://member.lieberleichter.de/unit/ll-m7-u3-fertigprodukte-machen-dich-fertig/", "https://member.lieberleichter.de/unit/ll-m7-u4-schadstoffe-im-essen/", "https://member.lieberleichter.de/unit/ll-u6-6-nutri-score/", "https://member.lieberleichter.de/unit/ll-m7-u5-weitere-tipps/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-zucker/", "https://member.lieberleichter.de/module/ll-umsetzung-m7-fit-mit-fett/", "https://member.lieberleichter.de/module/ll-umsetzung-m7-fit-mit-fett/", "https://member.lieberleichter.de/unit/ll-m8-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m8-u2-fit-mit-fett/", "https://member.lieberleichter.de/unit/ll-m8-u4-das-omega-3-geheimnis/", "https://member.lieberleichter.de/unit/ll-m8-u5-weitere-tipps-fit-mit-fett/", "https://member.lieberleichter.de/unit/ll-m8-u6-olivenoel/", "https://member.lieberleichter.de/unit/ll-m7-u6-bpc/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-fit-mit-fett/", "https://member.lieberleichter.de/module/challenge/", "https://member.lieberleichter.de/module/challenge/", "https://member.lieberleichter.de/unit/30-tage-challenge-jahresbeginn-2021/", "https://member.lieberleichter.de/unit/ll-7-tage-challenge/", "https://member.lieberleichter.de/unit/18-3-mit-einer-challenge-zu-neuen-gewohnheiten/", "https://member.lieberleichter.de/unit/18-4-challenge-webinar-aufzeichung/", "https://member.lieberleichter.de/module/gesund-essen-und-leben/", "https://member.lieberleichter.de/module/gesund-essen-und-leben/", "https://member.lieberleichter.de/unit/modul-14-food-as-medicine/", "https://member.lieberleichter.de/unit/ll-m9-u2-essen-im-alltag/", "https://member.lieberleichter.de/unit/blue-zones/", "https://member.lieberleichter.de/unit/modul-9-u3-mentale-gesundheit/", "https://member.lieberleichter.de/unit/digital-detox/", "https://member.lieberleichter.de/unit/rezepte/", "https://member.lieberleichter.de/unit/ll-modul-15-unit-5-tv-beitraege/", "https://member.lieberleichter.de/unit/ll-m15-unit-5-sporternaehrung/", "https://member.lieberleichter.de/unit/modul-14-u12-wasser/", "https://member.lieberleichter.de/module/vitamine/", "https://member.lieberleichter.de/module/vitamine/", "https://member.lieberleichter.de/unit/ll-m9-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m9-u2-mikronaehrstoffe/", "https://member.lieberleichter.de/unit/ll-m9-u3-vitamine-zum-abnehmen/", "https://member.lieberleichter.de/unit/ll-m9-u4-anti-stress-essen/", "https://member.lieberleichter.de/unit/die-orthomolekulare-medizin/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-vitamine/", "https://member.lieberleichter.de/unit/mach-mit-vitamine-messen/", "https://member.lieberleichter.de/module/moderne-ernaehrungsmedizin/", "https://member.lieberleichter.de/module/moderne-ernaehrungsmedizin/", "https://member.lieberleichter.de/unit/ll_anti-entzuendliche-ernaehrung/", "https://member.lieberleichter.de/unit/ll-14-metabolisches-syndrom/", "https://member.lieberleichter.de/unit/ll-m6-u5-insulinresistenz/", "https://member.lieberleichter.de/unit/ll-bonus-fettleber/", "https://member.lieberleichter.de/unit/ll-m6-u4-diabetes-epidemie-stoppen/", "https://member.lieberleichter.de/unit/bluthochdruck/", "https://member.lieberleichter.de/unit/ll-m8-u3-cholesterin-natuerlich-senken/", "https://member.lieberleichter.de/unit/unit-11-8-abnehmbremsen/", "https://member.lieberleichter.de/unit/modul-11-u9-darm/", "https://member.lieberleichter.de/unit/ll-m14-autoimmunerkrankungen/", "https://member.lieberleichter.de/unit/ll-m11-unit-11-gelenke/", "https://member.lieberleichter.de/unit/ll-bonus-u2-entgiftung/", "https://member.lieberleichter.de/unit/ll-m9-u5-laboranalysen/", "https://member.lieberleichter.de/unit/ll-m8-u5-saeure-basen-haushalt/", "https://member.lieberleichter.de/unit/ll-m14-u15-epigenetik/", "https://member.lieberleichter.de/unit/modul-gm-11-u16-nm-unv/", "https://member.lieberleichter.de/module/das-immunsystem/", "https://member.lieberleichter.de/module/das-immunsystem/", "https://member.lieberleichter.de/unit/immun/", "https://member.lieberleichter.de/unit/immunsystem-staerken-teil-2/", "https://member.lieberleichter.de/unit/modul-19-unit-4-wim-hof/", "https://member.lieberleichter.de/unit/modul-19-unit-4-post-covid/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnung-immunsystem/", "https://member.lieberleichter.de/module/hormone/", "https://member.lieberleichter.de/module/hormone/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u1-einleitung/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u2-weibliche-hormone/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u3-maennliche-hormone/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u4-stress-und-energiehormone/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u5-schilddruese/", "https://member.lieberleichter.de/unit/ll-m16-hormone-u6-webinare/", "https://member.lieberleichter.de/module/bewegung/", "https://member.lieberleichter.de/module/bewegung/", "https://member.lieberleichter.de/unit/ll-m12-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m12-u2-bewegung/", "https://member.lieberleichter.de/unit/ll-m12-u3-krafttraining/", "https://member.lieberleichter.de/unit/ll-m12-u4-training-fuer-vielbeschaeftigte/", "https://member.lieberleichter.de/unit/ll-m12-u5-das-kleinste-fitness-studio/", "https://member.lieberleichter.de/unit/ll-m12-u6-deutsche-sportabzeichen/", "https://member.lieberleichter.de/unit/ll-m12-u7-weitere-tipps/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-bewegung/", "https://member.lieberleichter.de/module/stress/", "https://member.lieberleichter.de/module/stress/", "https://member.lieberleichter.de/unit/ll-m11-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m11-u2-stress/", "https://member.lieberleichter.de/unit/ll-m11-u3-stress-abbauen/", "https://member.lieberleichter.de/unit/ll-m11-u4-entspannungsverfahren/", "https://member.lieberleichter.de/unit/ll-m11-u5-stressmessungen/", "https://member.lieberleichter.de/unit/ll-m11-u6-energiemangel/", "https://member.lieberleichter.de/unit/ll-m4-u4-kopfsache-schlank/", "https://member.lieberleichter.de/unit/ll-m10-u8-achtsamkeit/", "https://member.lieberleichter.de/unit/ll-m10-das-egoistische-gehirn/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-stresstoleranz/", "https://member.lieberleichter.de/module/schlaf/", "https://member.lieberleichter.de/module/schlaf/", "https://member.lieberleichter.de/unit/ll-m10-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m10-u2-schlafmangel/", "https://member.lieberleichter.de/unit/ll-m10-u4-weitere-tipps-infos/", "https://member.lieberleichter.de/unit/ll-m10-u3-regeneration/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-schlaf/", "https://member.lieberleichter.de/module/motivation/", "https://member.lieberleichter.de/module/motivation/", "https://member.lieberleichter.de/unit/ll-m4-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m4-u2-vortrag-motivation/", "https://member.lieberleichter.de/unit/ll-m4-u3-ein-brief-an-mich/", "https://member.lieberleichter.de/unit/ll-m4-u5-die-woop-methode/", "https://member.lieberleichter.de/unit/ll-m4-u6-prof-dr-gail-matthews/", "https://member.lieberleichter.de/unit/ll-m4-u7-placebo-effekt-mindset/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnung-motivation/", "https://member.lieberleichter.de/module/bilanz-ziehen/", "https://member.lieberleichter.de/module/bilanz-ziehen/", "https://member.lieberleichter.de/unit/ll-m13-u1-einfuehrung/", "https://member.lieberleichter.de/unit/ll-m13-u2-motivation/", "https://member.lieberleichter.de/unit/ll-m13-u3-wissen/", "https://member.lieberleichter.de/unit/ll-m13-u4-umsetzung/", "https://member.lieberleichter.de/unit/ll-m13-u5-erfolge/", "https://member.lieberleichter.de/unit/ll-webinaraufzeichnungen-erfolge/", "https://member.lieberleichter.de/module/bonus-material/", "https://member.lieberleichter.de/module/bonus-material/", "https://member.lieberleichter.de/unit/ll-m15-1-rabatt-codes/", "https://member.lieberleichter.de/unit/ll-m14-u3-podcast/", "https://member.lieberleichter.de/unit/ll-m15-unit-3-telegramm-gruppe/", "https://member.lieberleichter.de/unit/1-1-beratung/", "https://member.lieberleichter.de/module/train-the-trainer/", "https://member.lieberleichter.de/module/train-the-trainer/", "https://member.lieberleichter.de/unit/ll-m17-trainthetrainer-u1-adipositas-theraphie/", "https://member.lieberleichter.de/unit/ll-m17-trainthetrainer-u2-mikronaehrstoff-medizin/", "https://member.lieberleichter.de/unit/ll-m17-train-the-trainer-u3-omega3-fette/", "https://member.lieberleichter.de/unit/17-4-stressmedizin-fachvortraege/"]

# Ordner erstellen, um die heruntergeladenen Dateien zu speichern
download_folder = "downloads"
os.makedirs(download_folder, exist_ok=True)

def download_file(url, folder):
    local_filename = os.path.join(folder, os.path.basename(urlparse(url).path))
    
    # Skip download if the file already exists
    if os.path.exists(local_filename):
        print(f"File already exists, skipping: {local_filename}")
        return

    with requests.get(url, stream=True) as response:
        response.raise_for_status()
        with open(local_filename, 'wb') as file:
            for chunk in response.iter_content(chunk_size=8192):
                if chunk:
                    file.write(chunk)
    print(f"Downloaded: {local_filename}")

# Durchsuche die Links nach PDF- und MP3-Dateien und lade sie herunter
for link in links:
    absolute_url = urljoin(site_url, link)

    try:
        subpage_response = session.get(absolute_url)
        subpage_response.raise_for_status()
        subpage_content = subpage_response.content
        subpage_soup = BeautifulSoup(subpage_content, "html.parser")

        # Durchsuche die Unterseite nach PDF- und MP3-Dateien und lade sie herunter
        subpage_links = [a.get("href", "") for a in subpage_soup.find_all("a")]
        for subpage_link in subpage_links:
            subpage_absolute_url = urljoin(site_url, subpage_link)
            if subpage_absolute_url.endswith(('.pdf')):
                download_file(subpage_absolute_url, download_folder)
            if subpage_absolute_url.endswith(('.mp3')):
                download_file(subpage_absolute_url, download_folder)
    except requests.exceptions.HTTPError as err:
        print(f"Failed to access subpage with status code: {subpage_response.status_code}")
        print(f"Error details: {err}")
        continue